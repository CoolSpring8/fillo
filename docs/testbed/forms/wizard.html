<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-step Wizard Â· ApplyPilot Testbed</title>
    <link rel="stylesheet" href="../lib/styles.css" />
    <style>
      .wizard {
        display: grid;
        gap: 1.5rem;
        background: #fff;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 8px 40px rgba(15, 23, 42, 0.08);
      }

      .wizard-steps {
        position: relative;
        min-height: 320px;
      }

      .wizard-step {
        display: grid;
        gap: 1rem;
        animation: wizardFade 0.25s ease;
      }

      .wizard-step[hidden] {
        display: none;
      }

      .wizard-controls {
        display: flex;
        gap: 0.75rem;
        justify-content: flex-end;
      }

      .wizard-controls button[hidden] {
        display: none;
      }

      .wizard-progress {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        color: #475569;
      }

      progress {
        width: 60%;
        height: 0.75rem;
      }

      @keyframes wizardFade {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Multi-step Wizard</h1>
      <p class="testbed-banner">
        Mimics wizards that capture a few fields per step. Use the navigation buttons or keyboard to move between panels.
      </p>

      <form id="wizard-form" class="wizard">
        <div class="wizard-progress">
          <span id="wizard-step-label">Step 1 of 3</span>
          <progress id="wizard-progress" value="1" max="3"></progress>
        </div>

        <div class="wizard-steps">
          <section class="wizard-step" data-step="0" role="tabpanel" aria-labelledby="step-1">
            <h2 id="step-1">Contact</h2>
            <label>
              Preferred name
              <input type="text" data-autofill-key="basics.name.first" />
            </label>
            <label>
              Family name
              <input type="text" data-autofill-key="basics.name.last" />
            </label>
            <label>
              Email
              <input type="email" data-autofill-key="basics.email" />
            </label>
            <label>
              Alternate email
              <input type="email" data-autofill-key="basics.alternateEmail" />
            </label>
            <label>
              Phone
              <input type="tel" data-autofill-key="basics.phone" />
            </label>
          </section>

          <section class="wizard-step" data-step="1" role="tabpanel" aria-labelledby="step-2" hidden>
            <h2 id="step-2">Recent Employment</h2>
            <label>
              Title
              <input type="text" data-autofill-key="work[0].position" />
            </label>
            <label>
              Employer
              <input type="text" data-autofill-key="work[0].name" />
            </label>
            <label>
              Location
              <input type="text" data-autofill-key="work[0].location" />
            </label>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap">
              <label style="flex: 1 1 160px">
                Started
                <input type="month" data-autofill-key="work[0].startDate" />
              </label>
              <label style="flex: 1 1 160px">
                Ended
                <input type="month" data-autofill-key="work[0].endDate" />
              </label>
            </div>
            <label>
              Key achievement
              <textarea data-autofill-key="work[0].highlights[0]"></textarea>
            </label>
          </section>

          <section class="wizard-step" data-step="2" role="tabpanel" aria-labelledby="step-3" hidden>
            <h2 id="step-3">Education & Profiles</h2>
            <label>
              Institution
              <input type="text" data-autofill-key="education[0].institution" />
            </label>
            <label>
              Field of study
              <input type="text" data-autofill-key="education[0].area" />
            </label>
            <label>
              LinkedIn
              <input type="url" data-autofill-key="basics.profiles[0].url" />
            </label>
            <label>
              GitHub
              <input type="url" data-autofill-key="basics.profiles[1].url" />
            </label>
            <label>
              Personal statement
              <textarea data-autofill-key="basics.summary"></textarea>
            </label>
          </section>
        </div>

        <div class="wizard-controls">
          <button type="button" data-nav="prev" hidden>Back</button>
          <button type="button" data-nav="next">Next</button>
          <button type="submit" hidden>Submit</button>
        </div>
      </form>
    </main>

    <script>
      (() => {
        const form = document.getElementById('wizard-form');
        const steps = Array.from(form.querySelectorAll('.wizard-step'));
        const nextButton = form.querySelector('button[data-nav="next"]');
        const prevButton = form.querySelector('button[data-nav="prev"]');
        const submitButton = form.querySelector('button[type="submit"]');
        const label = document.getElementById('wizard-step-label');
        const progress = document.getElementById('wizard-progress');
        let current = 0;

        function updateView() {
          steps.forEach((step, index) => {
            step.hidden = index !== current;
            step.setAttribute('tabindex', index === current ? '0' : '-1');
          });
          label.textContent = `Step ${current + 1} of ${steps.length}`;
          progress.value = current + 1;
          prevButton.hidden = current === 0;
          nextButton.hidden = current === steps.length - 1;
          submitButton.hidden = current !== steps.length - 1;
          const active = steps[current];
          if (active && typeof active.focus === 'function') {
            active.focus({ preventScroll: false });
          }
        }

        nextButton?.addEventListener('click', () => {
          if (current < steps.length - 1) {
            current += 1;
            updateView();
          }
        });

        prevButton?.addEventListener('click', () => {
          if (current > 0) {
            current -= 1;
            updateView();
          }
        });

        form.addEventListener('keydown', (event) => {
          if (event.key === 'ArrowRight') {
            nextButton?.click();
          } else if (event.key === 'ArrowLeft') {
            prevButton?.click();
          }
        });

        form.addEventListener('submit', (event) => {
          event.preventDefault();
        });

        updateView();
      })();
    </script>
    <script src="../lib/harness.js"></script>
  </body>
</html>
